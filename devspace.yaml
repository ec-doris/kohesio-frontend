version: v1beta11

vars:
  - name: APP_IMAGE
    value: node:lts

deployments:
  - name: kohesio-config
    kubectl:
      manifests:
        - devspace/kohesio.yaml
  - name: kohesio-app
    helm:
      componentChart: true
      values:
        containers:
          - name: node
            image: ${APP_IMAGE}
            workingDir: /app
            command:
              - "/bin/sh"
            args:
              - "-c"
              - |
                sleep 99999999;
        service:
          ports:
            - port: 4200

dev:
  sync:
    - imageSelector: ${APP_IMAGE}
      containerPath: /app
      excludePaths:
        - .git/
        - .git/
        - .devspace/
        - devspace/
        - .angular/
        - README.md
      uploadExcludePaths:
        - Dockerfile
        - devspace.yaml
        - deploy/
        - node_modules/

hooks:
  - command: |
      npm install
    container:
      imageSelector: ${APP_IMAGE}
    events: ["after:initialSync:*"]

commands:
  - name: kohesio
    description: Run the application on local
    command: devspace enter -c node -- npm run devspace-start
    appendArgs: true
  - name: build-prod
    description: Build prod to check if everything is good
    command: devspace enter -c node -- npm run build-prod
    appendArgs: true

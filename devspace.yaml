version: v1beta11

vars:
  - name: APP_IMAGE
    value: loftsh/javascript:latest

deployments:
  - name: kohesio-config
    kubectl:
      manifests:
        - devspace/kohesio.yaml
  - name: kohesio-app
    helm:
      componentChart: true
      values:
        containers:
          - name: node
            image: ${APP_IMAGE}
            command:
              - "/bin/sh"
            args:
              - "-c"
              - |
                sleep 99999999;
        service:
          ports:
            - port: 4200

dev:
  sync:
    - imageSelector: ${APP_IMAGE}
      containerPath: /app
      excludePaths:
        - .git/
        - .git/
        - .devspace/
        - devspace/
        - .angular/
        - README.md
      uploadExcludePaths:
        - Dockerfile
        - devspace.yaml
        - deploy/
        - node_modules/

hooks:
  - command: |
      npm install
      npm run devspace-start
    container:
      imageSelector: ${APP_IMAGE}
    events: ["after:initialSync:*"]
